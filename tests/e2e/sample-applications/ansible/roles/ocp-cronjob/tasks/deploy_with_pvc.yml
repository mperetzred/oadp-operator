# Cron job will probably fail in 3.7 because of the api version. TODO: Adapt this to 3.7 too.
- name: Deploy cronjob using external image
  k8s:
    host: "{{ url }}"
    api_key: "{{ token }}"
    verify_ssl: no
    state : present
    namespace : "{{ namespace }}"
    definition: "{{ lookup('template', 'deployment_with_pvc.yml.j2')}}"
  vars:
    app_name: "{{ ext_app_name }}"
    docker_image: "{{ external_image_name }}" 

- name: sleep one minute to wait pvc bound
  pause:
    seconds: 70 

