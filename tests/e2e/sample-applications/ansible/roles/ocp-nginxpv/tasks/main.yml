- name: Clean up nginx-pv
  import_tasks: cleanup.yml
  when: with_cleanup|bool

- name: Disable ceph storage classes
  import_tasks: disable_ceph.yml
  when: disable_ceph is defined and disable_ceph|bool

- name: Create resources
  import_tasks: deploy.yml
  when: with_deploy|bool

- name: Validate source
  import_tasks: validate.yml
  when: with_validate|default(false)|bool

- name: Validate PVC not connected to anything
  import_tasks: validate-pvc-not-connected.yml
  when: with_delete_deployment|default(false)|bool

- name: Restore ceph storage classes
  import_tasks: restore_ceph.yml
  when: disable_ceph is defined and disable_ceph|bool

- name: Delete PVCs
  import_tasks: delete_pvcs.yml
  when: with_delete_pvcs |default(false)|bool
